<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Запускаем machine learning MVP: инструкция о том, как быстро презентовать идеи | My deep learning</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Запускаем machine learning MVP: инструкция о том, как быстро презентовать идеи" />
<meta name="author" content="Klepikov Konstantin" />
<meta property="og:locale" content="ru_RU" />
<meta name="description" content="Блог про нейронные сети и машинное обучение" />
<meta property="og:description" content="Блог про нейронные сети и машинное обучение" />
<link rel="canonical" href="https://konstantinklepikov.github.io/2021/01/10/zapuskaem-machine-learning-mvp.html" />
<meta property="og:url" content="https://konstantinklepikov.github.io/2021/01/10/zapuskaem-machine-learning-mvp.html" />
<meta property="og:site_name" content="My deep learning" />
<meta property="og:image" content="https://konstantinklepikov.github.io/assets/img/100121banner.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-10T00:00:00+02:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"https://konstantinklepikov.github.io/2021/01/10/zapuskaem-machine-learning-mvp.html","headline":"Запускаем machine learning MVP: инструкция о том, как быстро презентовать идеи","dateModified":"2021-01-10T00:00:00+02:00","datePublished":"2021-01-10T00:00:00+02:00","image":"https://konstantinklepikov.github.io/assets/img/100121banner.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://konstantinklepikov.github.io/2021/01/10/zapuskaem-machine-learning-mvp.html"},"author":{"@type":"Person","name":"Klepikov Konstantin"},"description":"Блог про нейронные сети и машинное обучение","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="keywords" content="machine learning, mvp, streamlit, github, МВП, прототип, машинное обучение, аналитика, covid">

  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon">

  
  
  <link rel="stylesheet" href="https://konstantinklepikov.github.io/assets/style.css">

  
      <!-- Yandex.Metrika counter -->
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(53548570, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
    });
  </script>
  <noscript><div><img src="https://mc.yandex.ru/watch/53548570" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
      <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-139620627-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-139620627-1');
  </script>
    <!-- <script data-ad-client="ca-pub-2809667403284871" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->
  

  <link rel="canonical" href="https://konstantinklepikov.github.io/2021/01/10/zapuskaem-machine-learning-mvp.html">
  <link rel="alternate" type="application/rss+xml" title="My deep learning" href="https://konstantinklepikov.github.io/feed.xml">

  <script async defer src="https://buttons.github.io/buttons.js"></script>

  <!-- Mathjax Support -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
  
  
    





  
</head>


  <body>

    <header class="border-bottom-thick px-2 clearfix">
  <div class="left sm-width-full py-1 mt-1 mt-lg-0">
    <a class="align-middle link-primary text-accent" href="/">
      My deep learning
    </a>
  </div>
  <div class="right sm-width-full">
    <ul class="list-reset mt-lg-1 mb-2 mb-lg-1">
      
        
      
        
      
        
      
        
      
        
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="/about/">
            Об авторе
          </a>
        </li>
        
      
        
      
        
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="/allposts/">
            Все посты
          </a>
        </li>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="/links/">
            Ссылки
          </a>
        </li>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      <li class="inline-block">
    <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="https://konstantinklepikov.github.io/myknowlegebase/">
        My knowlege base
    </a>
</li>
    </ul>
  </div>
</header>


    <div>
      <article class="container px-2 mx-auto mb4" itemscope itemtype="http://schema.org/BlogPosting">
  <h1 class="h1 col-9 sm-width-full py-4 mt-3 inline-block" itemprop="name headline">Запускаем machine learning MVP: инструкция о том, как быстро презентовать идеи</h1>
  <div class="col-4 sm-width-full mt-1 border-top-thin">
    <p class="py-2 bold h4"><time datetime="2021-01-10T00:00:00+02:00" itemprop="datePublished">Jan 10, 2021</time></p>
    <p class="mb-3 h5">Теги: 
    
      
      <a href="/tag/machine-learning," title="machine-learning," class="link-tags">machine-learning,&nbsp;</a>
    
      
      <a href="/tag/mvp," title="mvp," class="link-tags">mvp,&nbsp;</a>
    
      
      <a href="/tag/streamlit," title="streamlit," class="link-tags">streamlit,&nbsp;</a>
    
      
      <a href="/tag/github," title="github," class="link-tags">github,&nbsp;</a>
    
      
      <a href="/tag/python," title="python," class="link-tags">python,&nbsp;</a>
    
      
      <a href="/tag/zerocode," title="zerocode," class="link-tags">zerocode,&nbsp;</a>
    
      
      <a href="/tag/covid" title="covid" class="link-tags">covid&nbsp;</a>
    
    </p>
  </div>

  <div class="prose" itemprop="articleBody">
      <p><img src="../../../assets/img/100121banner.png" alt="Запускаем machine learning MVP: инструкция о том, как быстро презентовать идеи" /></p>

<p>Итак, есть идея и есть даже какая-то реализация в виде просчитанной модели, которая умеет, к примеру, классифицировать, распознавать или создавать новые объекты. Нам понятно как она устроена и, возможно, мы даже полностью понимаем математику, которая лежит в основе модели. Пришло время представить наше творение потенциальным инвесторам, будущим партнерам, публике на отчетной сессии хакатона или просто друзьям. Можно было бы воспользоваться сервисом типа <a href="https://colab.research.google.com/">colab</a> или связанного с ними <a href="https://www.kaggle.com/">kaggle</a> и опубликовать код “как есть”, но вот беда - те, кому мы хотим это показать плохо разбираются в коде, зато явно ждут чего-то эффектного. А строить полноценное приложение долго и дорого, необходимо разворачивать сервер и тратить время, которого и так нет. Как быть?</p>

<p>Итак, вот требования быстрому старту:</p>

<ul>
  <li>исходный код должен быть скрыт от пользователя - ведь мы же не хотим, чтобы ему стало скучно?</li>
  <li>необходимо разместить наш проект в интернете, чтобы разные пользователи смогли познакомиться с нашим гениальным изобретением</li>
  <li>наш проект должен получить готовые пользовательские интерфейсы, с помощью которых с ним можно было бы взаимодействовать</li>
  <li>нам очень не хотелось бы погружаться в разные языки программирования, а тем более в гипертекстовую разметку и прочий фронтенд</li>
  <li>точно необходимо избежать развертывания баз данных</li>
  <li>все нужно сделать быстро и, что важно, бесплатно</li>
</ul>

<p>Такое чувство, что нужен какой-то zerocode, в котором есть чуть-чуть кода, но это не точно. Я нашел такое решение и в этой статье я расскажу о том, как развернуть наш МВП всего за пару дней.</p>

<h2 id="схема-проекта">Схема проекта</h2>

<p>В качестве примера я построю приложение, визуализирующее данные о covid-19 для Калининградской области. В нем мы будем показывать пользователям различные представления табличных данных, попробуем визуализировать распределения и тренды. Мне понадобится:</p>

<ul>
  <li>где-то хранить и обновлять таблицы с данными</li>
  <li>хранить код разработки приложения</li>
  <li>реализовать в клиентском браузере отрисовку графиков</li>
  <li>разместить актуальный код на сервере в интернете</li>
</ul>

<p>Для этого я буду использовать следующий стек технологий и инструментов:</p>

<ul>
  <li><a href="https://www.python.org/">python</a> я буду использовать, потому что в целом на нем большая часть полезных инстументов для data science: обработка данных, моделирование, бекенд. Скорее всего, если мы беремся за машинное обучение, то прототип будет создан на python, поэтому есть смысл готовить МВП на нем же. Отлично. Теперь вся задача сводится к тому, чтобы выполнить всю остальную реализацию на python</li>
  <li><a href="https://numpy.org/">Numpy</a>, <a href="https://pandas.pydata.org/">pandas</a> обеспечат реализацию моей задачи: мне необходимо обработать данные, а результат вывести в виде графиков в приложении. Pandas, который написан поверх numpy, как раз для этого отлично подходит. С помощью этой библиотеки можно осуществлять численные операции над двумерными данными (таблицами), не теряя семантику. Это важно для создания быстрых прототипов, когда особо нет времени на оптимизацию и легко запутаться в идентификаторах.</li>
  <li><a href="https://altair-viz.github.io/">altair</a> - инструмент визуализации на python. Сразу поставляет необходимый фронт, в т.ч. и интерактивный. К тому же у него довольно простой и разнообразный интерфейс кода, который позволяет строить сложные визуализации не дорабатывая саму библиотеку.</li>
  <li><a href="https://www.streamlit.io/">streamlit</a> - с помощью этого продукта мы сделаем пользовательское приложение, тоже python. По сути streamlit оборачивает код на python, поставляет сервер и позволяет отображать результаты работы кода в вебе. Пакет специально был создан для МЛ-прототипирования, естественно нет речи о том, чтобы делать на нем что-то реально ценное, но мою задачу он решит идеально.</li>
  <li><a href="https://github.com/">github</a> - тут будем хранить рабочий код и обновлять данные. Github обеспечит разработку и непрерывную интеграцию с сервером, где мы разместим streamlit-приложение. Github action понадобится для того, чтобы не бодаться с cron на сервере, а выполнять обновления данных там, где живет разработка.</li>
  <li><a href="https://dashboard.heroku.com/apps">heroku apps</a> - облачный хостинговый и серверный сервис с возможностью бесплатного размещения python проектов. Выбор пал на него по нескольким причинам: бесплатный, python в комплекте, размещение в два клика, интеграция с github.</li>
  <li><a href="https://www.google.com/sheets/about/">google sheets</a> в качестве замены базы данных.</li>
</ul>

<p>Вот схема проекта. В гугл-таблицах мы будем агрегировать данные, затем на github с помощью github-action делать предобработку и сохранять результат в .csv. Пользовательское приложение будет собираться на heroku, а данные получать из .csv на github. В итоге у нас минимум серверной работы, нет базы данных, а весь код написан на python. То что нужно.</p>

<p><img src="../../../assets/img/100121-01.png" alt="cheeme" /></p>

<h2 id="реализация">Реализация</h2>

<p>Python и все необходимые библиотеки у меня уже есть. Streamlit и altair довольно просто ставятся с <a href="https://pypi.org/">pypi</a>. <a href="https://git-scm.com/">Git</a> на моей локальной машине тоже установлен.</p>

<p>Я создал новый аккаунт на heroku, указал, что разработка приложения будет вестись на python 3.8. Аккаунт на github у меня уже был. На гитхабе я создал отдельный репозиторий, main которого будет автомотически комититься на heroku при каждом обновлении. Интеграция гитхаба и heroku с автобилдами реализуется <a href="https://devcenter.heroku.com/articles/github-integration">в два клика</a>.</p>

<p>Чтобы реализовать связку heroku-github мне понадобится такая структра проекта:</p>

<ul>
  <li>.gitignore</li>
  <li>.slugignore</li>
  <li>Procefile</li>
  <li>setup.sh</li>
  <li>requirements.txt</li>
  <li>файлы и каталоги приложения</li>
</ul>

<p>В .gitignore добавлено все, что мы не хотим видеть в нашем репозитерии. На этот же файл смотрит и heroku при деплое.</p>

<p><a href="https://devcenter.heroku.com/articles/slug-compiler#ignoring-files-with-slugignore">.slugignore</a> понадобится для того, чтобы спрятать какие-то объекты, которые находятся в репозитории на github уже от heroku.</p>

<p>В requirements.txt пропишем необходимые python пакеты. Heroku будет обновлять нужные библиотеки автоматически при деплое. К сожалению серверный установщик не подружился с тем набором версий пакетов, которые я указал в requirements.txt , но так-как мне не принципиально, то в конечном итоге я указал пакеты без версий: numpy, pandas, altair, streamlit</p>

<p><a href="https://devcenter.heroku.com/articles/procfile">Procefile</a> реализует на heroku то, что нам нужно запустить при старте сервера. В моем случае все просто, я конфигурирую и запускаю сервер streamlit:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>web: sh setup.sh &amp;&amp; streamlit run main.py
</code></pre></div></div>

<p>Простенькая конфигурация в setup.sh</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.streamlit/

<span class="nb">echo</span> <span class="s2">"</span><span class="se">\</span><span class="s2">
[general]</span><span class="se">\n\</span><span class="s2">
email = </span><span class="se">\"</span><span class="s2">oformleno@gmail.com</span><span class="se">\"\n\</span><span class="s2">
"</span> <span class="o">&gt;</span> ~/.streamlit/credentials.toml

<span class="nb">echo</span> <span class="s2">"</span><span class="se">\</span><span class="s2">
[server]</span><span class="se">\n\</span><span class="s2">
headless = true</span><span class="se">\n\</span><span class="s2">
enableCORS=false</span><span class="se">\n\</span><span class="s2">
port = </span><span class="nv">$PORT</span><span class="se">\n\</span><span class="s2">
"</span> <span class="o">&gt;</span> ~/.streamlit/config.toml
</code></pre></div></div>

<p>Само приложение я разбил на две части: пользовательскую часть и часть, которая будет готовить данные.</p>

<p>Пользовательская часть в файле main.py содержит исполняемый код на python, который будет запускаться при доступе по адресу страницы приложения. Собственно этот код содержит в себе все, что взаимодействует с остальными данными на heroku и отображает пользовательский интерфейс. В первую очередь приложение потребляет данные, на основе которых строятся визуализации. Так как данных немного и у нас нет БД, я их получаю из .csv, который расположен на github. Данные я сразу преобразую в массив pandas с помощью read_csv(), а из массива сразу строю графики на altair.</p>

<p>Далее, все что отрисовал altair, а так-же тексты, гиперссылки и другой контент отображается из python на страницу в браузере пользователя при помощи streamlit. У последнего довольно тривиальный <a href="https://share.streamlit.io/daniellewisdl/streamlit-cheat-sheet/app.py">набор методов</a>, есть нужные мне <a href="https://www.streamlit.io/components">интеграции</a>, довольно простая и понятная <a href="https://docs.streamlit.io/en/stable/index.html">документация</a> и множество готовых решений от <a href="https://discuss.streamlit.io/">комьюнити</a>.</p>

<p>“Серверная часть” расположена в dataprocessor.py. Этот скрипт запускается на github с помощью github action и решает следующие задачи:</p>

<ul>
  <li>google sheets позволяет агрегировать данные руками или регулярно выгружать туда данные скрапером, но в конечном итоге это не БД. Структура данных там архаична, есть пропуски, не хватает некоторых столбцов и значений, есть проблемы с форматом. К тому же таблица в неудобном excel-подобном формате. С помощью python скрипта я делаю препроцессинг данных и отдаю в репозиторий готовый к построению графиков csv</li>
  <li>по той же причине (отсутствие БД) мне бы хотелось убрать все дорогостоящие вычисления подальше от пользователя</li>
  <li>я сознательно отказался от cron на heroku, так как проект хостится бесплатно, а <a href="https://devcenter.heroku.com/articles/scheduler">heroku scheduler</a> и подобные шедалеры либо неудобны, либо плохо управляемые, либо работают нерегулярно, либо платные</li>
  <li>обновлять данные мне надо раз в 15 минут. Так как репозиторий на github бесплатный, соответствующий экшен мне тоже ничего не стоит и никак не лимитирован.</li>
</ul>

<p>Выглядит громоздко, но на самом деле все просто! Поверьте, гораздо проще, чем возиться с базой данных (не стоит забывать, что я делаю МВП, времени в обрез, а деньги заканчиваются :)</p>

<p>В репозитории проекта помимо веток разработки я создал отдельную ветку datasets, в которую будут складываться csv-файлы после выполнения экшена на github. Эта ветка будет виртуальным хранилищем наших данных - так-как репозиторий открытый, то и доступ к данным тоже может осуществляться по прямой ссылке. Ветку, очевидно, я никогда не стану сливать с main-ом и коммитить в нее буду только изменения в dataprocessor.py, скрипте, который отвечает за экшен на github.</p>

<p>Забирать данные для препроцессинга с google sheets мы будем тоже по прямой ссылке вида;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://docs.google.com/spreadsheets/d/{file_id}/gviz/tq?tqx=out:csv&amp;sheet={sheet_name}
</code></pre></div></div>

<p>Тут {file_id} айдишник моей таблицы, а {sheet_name} вкладка. Делаем таблицу публичной и будем разбирать ее в виде csv по вкладкам.</p>

<p>Итак, у нас есть работающий процесс: забираем google таблицу в виде csv, обрабатываем в pandas, выкладываем в ветку репозитория на github, откуда таблицу видно на heroku. Осталось разобраться с экшенами.</p>

<p><a href="https://docs.github.com/en/free-pro-team@latest/actions/quickstart">Github action</a> позволяет запускать исполняемые скрипты по времени или в ответ на события. В моем случае нужно по времени. Как собираются экшены можно почитать <a href="https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions/introduction-to-github-actions">тут</a>. Я реализую следующий сценарий:</p>

<ul>
  <li>раз в 15 минут</li>
  <li>перейти на ветку datasets</li>
  <li>установить python зависимости</li>
  <li>выполнить dataprocessor.py</li>
  <li>если есть изменеения в .csv файлах - сделать коммит в datasets</li>
</ul>

<p>О том, как работать с python в github action можно прочитать <a href="https://docs.github.com/en/free-pro-team@latest/actions/guides/building-and-testing-python">здесь</a>. Для реализации плана в основном репозитории я создал каталог .github, в нем подкаталог workflows, а в нем файл dataloader.yml. Github самостоятельно распознает наличие экшена и начнет его выполнять по расписанию. Получилось следующее:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Autoupdate raw-data</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span>  <span class="s1">'</span><span class="s">*/15</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">3.8.6</span><span class="pi">]</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">ref</span><span class="pi">:</span> <span class="s">datasets</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Python $</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="s">$</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cache pip</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">~/.cache/pip</span>
        <span class="na">key</span><span class="pi">:</span> <span class="s">$-pip-$</span>
        <span class="na">restore-keys</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">$-pip-</span>
          <span class="s">$-</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">python -m pip install --upgrade pip</span>
        <span class="s">if [ -f requirements.txt ]; then pip install -r requirements.txt; fi</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run dataprocessor</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">python dataprocessor.py</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/upload-artifact@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">raw-data</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">data/*.csv</span>
        <span class="na">retention-days</span><span class="pi">:</span> <span class="m">1</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">stefanzweifel/git-auto-commit-action@v4</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">commit_message</span><span class="pi">:</span> <span class="s">Autoupdate raw-data</span>
        <span class="na">branch</span><span class="pi">:</span> <span class="s">datasets</span>
        <span class="na">push_options</span><span class="pi">:</span> <span class="s1">'</span><span class="s">--force'</span>
        <span class="na">file_pattern</span><span class="pi">:</span> <span class="s">data/*.csv</span>
</code></pre></div></div>

<ul>
  <li>мы создали экшен с названием Autoupdate raw-data</li>
  <li>настроили cron на гитхабе с таймером в 15 минут</li>
  <li>с помощью готового решения actions/checkout@v2 перескочили в ветку datasets</li>
  <li>установили python 3.8 в окружении на github, а так-же все зависимости из requirements.txt. Чтобы не ходить по кругу несколько раз установка кешируется с помощью actions/cache@v2</li>
  <li>выполнили dataprocessor.py</li>
  <li>с помощью actions/upload-artifact@v2 получили артефакты выполнения скрипта. Это csv-шки. Указали, что будем хранить их ровно сутки.</li>
  <li>с помощью stefanzweifel/git-auto-commit-action@v4 отправили их в ветку</li>
  <li>по завершению экшена github сам сделал чекаут и подчистил следы :)</li>
</ul>

<p>Немного пояснений в части артефактов. Гитхаб при исполнении экшенов создает объекты не в репозитории, а в отдельном пространстве. Они хранятся в архивированном виде и извне не доступны. Если мы хотим извлечь какие-то объекты в процессе обработки экшена, это необходимо выполнить отдельным действием.</p>

<p>Вот немного ссылок: <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#about-yaml-syntax-for-workflows">синтаксис</a>, <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#scheduled-events">синтаксис шедалера</a>, <a href="https://github.com/actions/upload-artifact">upload artifacts</a>, <a href="https://github.com/marketplace/actions/git-auto-commit">autocommit</a></p>

<p>Вот и все. Собираем: выгружаем данные в таблицы, коммитим на github, делаем pull request в main. Ждем деплоя на heroku. Ждем обработки в github action. <a href="https://covid-kaliningrad.herokuapp.com/">Смотрим результат</a>.</p>

<p><a href="https://github.com/KonstantinKlepikov/covid-kaliningrad">Репозиторий проекта тут</a></p>

<h2 id="с-какими-проблемами-пришлось-столкнуться">С какими проблемами пришлось столкнуться</h2>

<ul>
  <li>Преобразование в формат datatime в pandas иногда приносит сюрпризы. Можно получить перестановку местами дня и месяца. Это не баг, а небольшой фокус обработки, о котором можно и не знать. Заметить его трудно. В итоге на выходе можно получить что-то наподобии:</li>
</ul>

<p><img src="../../../assets/img/040121-01.png" alt="data-bug" /></p>

<p><a href="https://stackoverflow.com/questions/36998540/pd-read-csv-not-correctly-parsing-date-month-field-when-set-parse-date-colum">Решение проблемы</a></p>

<ul>
  <li>
    <p>Altair не работает с индексом pandas - его необходимо сбросить. Лучше всего кормить графики массивом данных, состощим из трех колонок: значения для оси X, маппинг названий для разных наборов данных, которые мы собираемся отобразить на графиках, и собственно непосредственно сами значения для оси Y</p>
  </li>
  <li>
    <p>Необходимо следить за типом данных в google sheets. Там может быть абсолютно неожиданные формат чисел или смешанный формат для числовых данных. Pandas поймет эти данные неправильно, но ошибку не выдаст. Особенно это касается чисел с плавающей точкой: мало того, что при неверно указанном формате pandas округлит значения, так еще и в гугл-таблицах значения содержатся с запятой вместо точки. Это придется обработать отдельно.</p>
  </li>
  <li>
    <p>Не смотря на описание в heroku деплой там срабатывает не на релизы, а на коммиты в main github-репозитория. по этой причине я вынес обработку данных в отдельную ветку.</p>
  </li>
  <li>
    <p>Округление float в numpy работает не так, как вы ожидаете. Проблема <a href="https://github.com/pandas-dev/pandas/issues/35124">известна</a>, но не решена.</p>
  </li>
  <li>
    <p>Удаляйте пустые столбцы в гугл-таблицах, иначе получите их в csv-файле.</p>
  </li>
  <li>
    <p>В собранном приложении streamlit отображает меню разработки (в нем несколько не сильно полезных инструментов типа перезагпузки страницы). Вы наверняка захотите это <a href="https://discuss.streamlit.io/t/how-do-i-hide-remove-the-menu-in-production/362/10">убрать</a>.</p>
  </li>
</ul>

<h2 id="выводы">Выводы</h2>

<p>Предложенное решение позволяет быстро собрать серверное приложение с достаточным для презентации интерфейсом. База данных не нужна. Конфигурация сервера по сути не нужна. Работает на бесплатных хостингах с бесплатным кроном. Идеально для хакатонов - собирается за несколько часов до презентации. Работает из коробки.</p>

<p>Пример, который я реализовал - это конечно по сути лапшекод написаный на коленке, Но именно это отражает идею MVP: собирай быстро, показывай и двигайся дальше. Задача заключалась в демонстрации простого решения поставленной цели. Надеюсь это будет Вам полезно.</p>

<p><a href="https://github.com/KonstantinKlepikov/covid-kaliningrad">Репозиторий проекта</a></p>

<p><a href="https://covid-kaliningrad.herokuapp.com/">Результат работы</a></p>

  </div>
    
      <!-- Yandex.RTB R-A-734189-1 -->
<div id="yandex_rtb_R-A-734189-1"></div>
<script type="text/javascript">
    (function(w, d, n, s, t) {
        w[n] = w[n] || [];
        w[n].push(function() {
            Ya.Context.AdvManager.render({
                blockId: "R-A-734189-1",
                renderTo: "yandex_rtb_R-A-734189-1",
                async: true
            });
        });
        t = d.getElementsByTagName("script")[0];
        s = d.createElement("script");
        s.type = "text/javascript";
        s.src = "//an.yandex.ru/system/context.js";
        s.async = true;
        t.parentNode.insertBefore(s, t);
    })(this, this.document, "yandexContextAsyncCallbacks");
</script>
    
    <div id="share-bar">

    <h4>Поделиться статьей</h4>

    <div class="share-buttons">
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://konstantinklepikov.github.io/2021/01/10/zapuskaem-machine-learning-mvp.html&title=Запускаем machine learning MVP: инструкция о том, как быстро презентовать идеи" nclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Поделиться на Facebook" class="link-primary" target="_blank" rel="noopener">
            <i class="fa fa-facebook-official share-button"> facebook</i>
        </a>

        <a href="https://twitter.com/intent/tweet?text=Запускаем machine learning MVP: инструкция о том, как быстро презентовать идеи&url=https://konstantinklepikov.github.io/2021/01/10/zapuskaem-machine-learning-mvp.html" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Поделиться на Twitter" class="link-primary" target="_blank" rel="noopener">
            <i class="fa fa-twitter share-button"> twitter</i>
        </a>

        <a href="https://vk.com/share.php?url=https://konstantinklepikov.github.io/2021/01/10/zapuskaem-machine-learning-mvp.html&title=Запускаем machine learning MVP: инструкция о том, как быстро презентовать идеи" title="Поделиться в vkontakte" class="link-primary" target="_blank" rel="noopener">
            <i class="fa fa-vk share-button"> vkontakte</i>
        </a>

        <a  href="mailto:?subject=Запускаем machine learning MVP: инструкция о том, как быстро презентовать идеи&body=Check out this site https://konstantinklepikov.github.io/2021/01/10/zapuskaem-machine-learning-mvp.html"
        title="Отправить по почте" >
        <i class="fa fa-envelope share-button"> email</i>
    </a>
    </div>

</div>
    <script src="https://utteranc.es/client.js"
        repo="KonstantinKlepikov/KonstantinKlepikov.github.io"
        issue-term="url"
        label="blog-comments"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
  

  <p class="h4 mt-2">Все статьи с тегом <a href="/tag/mvp" class="link-tags">mvp</a></p>
  <div class="prose mb-2">
    <ul>
        
    </ul>
  </div>

</article>

<div class="container mx-auto px-2 py-2 clearfix">
  <!-- Use if you want to show previous and next for all posts. -->



  <div class="col-4 sm-width-full left mr-lg-4 mt-3">
    <a class="no-underline border-top-thin py-1 block" href="https://konstantinklepikov.github.io/2020/11/05/svertochnie-neyronnie-seti-dlja-grafov-chast-2-practica.html" title="Сверточные нейронные сети для графов. Часть 2 (практика)">
      <span class="h5 link-secondary text-accent">Предыдущая запись</span>
      <p class="bold h3 link-primary mb-1">Сверточные нейронные сети для графов. Часть 2 (практика)</p>
      <p>Семинар, посвященный практике по графовым нейронным сетям, можно посмотреть на youtube: Вначале еще раз разбираем теоретическую часть вопроса. Затем смотрим...</p>
    </a>
  </div>
  
  
  <div class="col-4 sm-width-full left mt-3">
    <a class="no-underline border-top-thin py-1 block" href="https://konstantinklepikov.github.io/2021/01/19/fishki-pandas-part-1.html" title="Фишки pandas: часть 1">
      <span class="h5 link-secondary text-accent">Следующая запись</span>
      <p class="bold h3 link-primary mb-1">Фишки pandas: часть 1</p>
      <p>![{{page.title}}](../../..{{page.image}}) Стартую серию заметок про различные проблемы и фишки, с которыми мне пришлось столкнуться в python библиотеке pandas. В этом...</p>
    </a>
  </div>


</div>

    </div>

    <div class="border-top-thin clearfix mt-2 mt-lg-4">
  <div class="container mx-auto px-2">
    <p class="col-8 sm-width-full left py-2 mb-0">Этот проект поддерживается <a class="text-accent" href="https://github.com/KonstantinKlepikov">KonstantinKlepikov</a></p>
    <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
      <li class="inline-block mr-1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="My deep learning">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      <li class="inline-block">
        <a class="github-button" href="https://github.com/KonstantinKlepikov/" data-icon="octicon-star" data-count-href="KonstantinKlepikov//stargazers" data-count-api="/repos/KonstantinKlepikov/#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star KonstantinKlepikov/ on GitHub">Star</a>
      </li>
    </ul>
  </div>
</div>


  </body>

</html>
